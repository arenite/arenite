IOC=function(n){var e=new IOC.Object(e);e=e.object.extend(e,new IOC.Loader),e=e.object.extend(e,new IOC.Async),e=e.object.extend(e,new IOC.Url),e=e.object.extend(e,new IOC.DI(e)),e.di.loadConfig(n)},IOC.Async=function(){var n=function(n,e,t){var o=0,c=n.length,i=function(){c>o?e(n[o++]):t()};return{next:i}},e=function(n,e,t){var o=t||(new Date).getTime();window.console.groupCollapsed('Latch: Starting latch "'+o+'" for',n,"times"),window.console.trace(),window.console.groupEnd();var c=0;return{countDown:function(){c++,window.console.log('Latch: Counting down latch "'+o+'" ,',n-c,"remaining"),c===n&&(window.console.log('Latch: Triggering latch "'+o+'"'),e(c))},countUp:function(){c--,window.console.log('Latch: Counting up latch "'+o+'" ,',n-c,"remaining"),c===n&&(window.console.log('Latch: Triggering latch "'+o+'"'),e(c))}}};return{async:{seqLatch:function(e,t,o){return n(e,t,o)},latch:function(n,t,o){return new e(n,t,o)}}}},IOC.DI=function(n){var e={},t={},o=function(e){var t=!1,o=[];return e.forEach(function(e){if("undefined"!=typeof e.value)o.push(e.value);else if("undefined"!=typeof e.ref){var c=n.di.getInstance(e.ref);c?o.push(c):t=!0}else"undefined"!=typeof e.func?o.push(e.func):"undefined"!=typeof e.exec&&o.push(e.exec())}),t?null:o},c=function(e,t,c){var i="function"==typeof t?t:n.object.get(n.di.getInstance(e),t);if(!i)throw'Unknown function "'+t+'" for instance "'+e+'"';var r=o(c||[]);if(!r)throw'Unable to resolve arguments for "'+t+'" of instance "'+e+'"';i.apply(i,r)},i=function(n,o,c,i){e[n]=o,c&&(t[n]=i||[])},r=function(n){if(t.hasOwnProperty(n)){var c=o(t[n]);if(c)return e[n].apply(e[n],c);throw'Unable to resolve arguments for "'+n}return e[n]},a=function(e){if(!e)throw"Your context defines no instances";var t=n.object.keys(e),c={};t.forEach(function(t){var i=n.object.get(window,e[t].namespace);if(!i)throw'Unknown function "'+e[t].namespace+'"';var r=o(e[t].args||[]);if(r){window.console.log(t,"wired");var a=e[t].factory?i:i.apply(i,r);n.di.addInstance(t,a,e[t].factory,e[t].args||[]),e[t].extension&&(n=n.object.extend(n,a))}else c[t]=e[t]});var i=n.object.keys(c);if(i.length!==e.length&&i.length>0)a(c);else if(0!==i.length)throw"Make sure you don't have circular dependencies, Unable to resolve the following instances: "+i.join(", ")},f=function(e){n.object.keys(e).forEach(function(n){e[n].init&&c(n,e[n].init.func,e[n].init.args)})},u=function(n){"complete"!==document.readyState?window.setTimeout(function(){u(n)},100):n.forEach(function(n){n.instance?c(n.instance,n.func,n.args):n.func&&c(null,n.func,n.args)})},s=function(){var e=n.config.context.dependencies[n.config.mode],t=n.async.seqLatch(e.sync||[],function(e){n.loader.loadScript(e,t.next)},function(){var t=n.async.latch(e.async?e.async.length:0,function(){window.console.log("wire instances"),a(n.config.context.instances),window.console.log("init instances"),f(n.config.context.instances),window.console.log("start instances"),u(n.config.context.start)},"dependencies");e.async.forEach(function(e){n.loader.loadScript(e,t.countDown)})});t.next()},d=function(e){for(var t=e.pop(),o=[];t;)n.object.get(window,t.namespace)?n.config=n.object.extend(n.config,n.object.get(window,t.namespace)()):o.push(t),t=e.pop();if(0!==o.length){var c=n.async.latch(o.length,function(){d(o)},"imports");o.forEach(function(e){n.loader.loadScript(e.url,c.countDown)})}else s()},l=function(e){n.di.addInstance("ioc",n),n.config=e,n.config.mode=n.url.query().env||"default",window.console.log("IOC: Starting in mode",n.config.mode),e.exposeIoc&&(window.ioc=n),n.config.imports?d(JSON.parse(JSON.stringify(n.config.imports))):s()};return{di:{loadConfig:l,getInstance:r,addInstance:i}}},IOC.Loader=function(){var n=function(n,e){var t=document.getElementsByTagName("head")[0],o=document.createElement("script");o.type="text/javascript",o.src=n,o.onreadystatechange=o.onload=function(){window.console.log("IOC: Loaded",n),"function"==typeof e&&e()},window.console.log("IOC: Loading",n),t.appendChild(o)},e=function(n,e,t){var o=new window.XMLHttpRequest;o.open("GET",n),o.onreadystatechange=function(){4===o.readyState&&(o.status%100<4?e(o):"function"==typeof t&&t(o))},o.send()};return{loader:{loadResource:e,loadScript:n}}},IOC.Object=function(){var n=function(n,e){if(n){var t=e.split("."),o=t.splice(t.length-1,1),c=n;return t.forEach(function(n){c&&(c[n]||(c[n]={}),c=c[n])}),{object:c,path:o}}},e=function(n,e){if(n){var t=e.split("."),o=n;return t.forEach(function(n){o&&(o=o[n])}),o}},t=function(e,t,o){var c=n(e,t);return c&&c.object?(c.object[c.path]=o,c.object[c.path]):void 0},o=function(e,t){var o=n(e,t);o&&o.object&&delete o.object[o.path]},c=function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]&&"object"==typeof n[t]?n[t].constructor===Array&&e[t].constructor===Array?n[t]=a(n[t].concat(e[t])):c(n[t],e[t]):n[t]=e[t]);return n},i=function(n){var e,t=[];for(e in n)n.hasOwnProperty(e)&&t.push(e);return t},r=function(n,e){if(n.length){var t=!1;return n.forEach(function(n){t=t||n===e}),t}for(var o in n)if(n.hasOwnProperty(o)&&o===e)return!0;return!1},a=function(n){var e=[];return n.forEach(function(n){e.indexOf(n)<0&&e.push(n)}),e};return{object:{get:e,set:t,"delete":o,extend:c,keys:i},array:{contains:r,uniq:a}}},IOC.Url=function(){return{url:{query:function(){for(var n={},e=window.location.search.substring(1),t=e.split("&"),o=0;o<t.length;o++){var c=t[o].split("=");"undefined"==typeof n[c[0]]?n[c[0]]=c[1]:"string"==typeof n[c[0]]?n[c[0]]=[n[c[0]],c[1]]:n[c[0]].push(c[1])}return n}}}};