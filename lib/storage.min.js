var storage=function(e,t){var n={sequencialActionCallbackWrapper:function(e,t,n){var r=0;var i=e.length;var s=function(){if(r<i){t(e[r++])}else{n()}};return{next:s}},multipleActionCallbackWrapper:function(e,t){var n=[];return{countDown:function(r){n.push(r);if(n.length===e){t(n)}}}}};var r=function(t){if(!t){e()}else{e({set:function(e,n,r){t.set(e,n,r)},setAll:function(e,n,r){t.setAll(e,n,r)},get:function(e,n,r){t.get(e,n,r)},getAll:function(e,n){t.getAll(e,n)},remove:function(e,n,r){t.remove(e,n,r)},removeAll:function(e,n){t.removeAll(e,n)},ready:function(e){t.ready(e)},close:t.close})}};switch(t){case"LocalStorage":storage.KeyValue(r,n);break;case"SessionStorage":storage.KeyValue(r,n,true);break;case"WebSQL":storage.WebSQL(r,n);break;case"IndexedDB":storage.IndexedDB(r,n);break;default:if(window.openDatabase){window.console.log("Using WebSQL");storage.WebSQL(r,n)}else if(window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB){window.console.log("Using IndexedDB");storage.IndexedDB(r,n)}else{window.console.log("Using LocalStorage");storage.KeyValue(r,n)}break}};storage.KeyValue=function(e,t,n){try{var r=n?sessionStorage:localStorage}catch(i){e();return}var s=function(e,t,n){var i=JSON.parse(r.getItem(e));var s=i.length;for(var o=0;o<s;o++){if(i[o].id===t){n(i[o]);return}}n()};var o=function(e,t,n){var i=JSON.parse(r.getItem(e))||[];var s=false;var o=i.length;for(var u=0;u<o;u++){if(i[u].id===t.id){s=true;i[u]=t}}if(!s)i.push(t);r.setItem(e,JSON.stringify(i));n()};var u=function(e,t){var n=JSON.parse(r.getItem(e));var i=n.length;for(var s=0;s<i;s++){if(n[s].id===t){n.splice(s,1);r.setItem(e,JSON.stringify(n));return}}};e({set:o,setAll:function(e,n,r){var i=t.multipleActionCallbackWrapper(n.length,r);n.forEach(function(t){o(e,t,i.countDown)})},get:s,getAll:function(e,t){var n=r.getItem(e);t(n?JSON.parse(n):[])},remove:function(e,t,n){u(e,t);n()},removeAll:function(e,t){r.removeItem(e);t()},close:function(){}})};storage.WebSQL=function(e,t){var n;var r=function(e,t){n.transaction(function(n){n.executeSql("CREATE TABLE if not exists "+e+"(id TEXT NOT NULL, value TEXT, PRIMARY KEY(id));",[],t,function(e,t){window.console.log("Oops.  Error was "+t.message+" (Code "+t.code+")",t)})})};var i=function(e,t,s){n.transaction(function(n){n.executeSql("INSERT OR REPLACE into "+e+"(id, value) VALUES ( ?, ? );",[t.id,JSON.stringify(t)],function(){s()},function(n,o){if(o.code===5){window.console.log("WebSQL: going to create table "+e);r(e,function(){window.console.log("WebSQL: created table "+e);i(e,t,s)})}else{window.console.log("WebSQL Error: "+o.message+" (Code "+o.code+")",o);s()}})})};var s=function(e,t,r){n.transaction(function(n){n.executeSql("select value from "+e+" where id=?;",[t],function(e,t){r(t.rows.length>0?JSON.parse(t.rows.item(0).value):undefined)},function(e,t){if(t.code===5){r()}else{window.console.log("WebSQL Error: "+t.message+" (Code "+t.code+")",t);r()}})})};var o=function(e,t){n.transaction(function(n){n.executeSql("select value from "+e,[],function(e,n){var r=[];var i=n.rows.length;for(var s=0;s<i;s++){r.push(JSON.parse(n.rows.item(s).value))}t(r)},function(e,n){if(n.code===5){t([])}else{window.console.log("WebSQL Error: "+n.message+" (Code "+n.code+")",n);t()}})})};var u=function(e,t,r){n.transaction(function(n){n.executeSql("delete from "+e+" where id=?",[t],r,function(e,t){window.console.log("WebSQL Error: "+t.message+" (Code "+t.code+")",t);r()})})};var a=function(e,t){n.transaction(function(n){n.executeSql("drop table "+e+"",[],t,t)})};try{if(!window.openDatabase){window.console.log("SQL Database not supported");e()}else{var f="storage.js";var l="1.0";var c="storage.js database";var h=65536;n=openDatabase(f,l,c,h);e({set:i,setAll:function(e,n,r){var s=t.multipleActionCallbackWrapper(n.length,r);n.forEach(function(t){i(e,t,s.countDown)})},get:s,getAll:o,remove:u,removeAll:a,close:function(){}})}}catch(p){if(p===2){window.console.log("Invalid database version.")}else{window.console.log("Unknown error "+p+".")}}};storage.IndexedDB=function(e,t){var n=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;var r=window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.msIDBTransaction;var i;var s=function(e,t){i.close();var r=n.open("storage_js",(new Date).getTime());r.onupgradeneeded=function(t){i=r.result;i.createObjectStore(e,{keyPath:"id"})};r.onsuccess=function(){t()}};var o=function(e,t,n){try{if(!i.objectStoreNames.contains(e)){window.console.log("IndexedDB: going to create objectStore "+e);s(e,function(){window.console.log("IndexedDB: created objectStore "+e);o(e,t,n)});return}var r=i.transaction([e],"readwrite");var u=r.objectStore(e);var a=u.put(t);r.onerror=function(e){window.console.log("IndexedDB Error: "+f.message+" (Code "+f.code+")",f)};a.onsuccess=function(){n()};a.onerror=function(e){window.console.log("IndexedDB Error: "+f.message+" (Code "+f.code+")",f)}}catch(f){if(f.code!==3&&f.code!==8){window.console.log("IndexedDB Error: "+f.message+" (Code "+f.code+")",f);n()}else{window.console.log("IndexedDB: going to create objectStore "+e);s(e,function(){o(e,t,n)})}}};var u=function(e,t,n){try{var r=i.transaction([e],"readwrite");r.onerror=function(e){window.console.log("IndexedDB Error: "+o.message+" (Code "+o.code+")",o)};var s=r.objectStore(e);s.get(t).onsuccess=function(e){n(e.target.result)}}catch(o){window.console.log("IndexedDB Error: "+o.message+" (Code "+o.code+")",o);n()}};var a=function(e,t){try{var n=[];var r=i.transaction([e],"readwrite");r.onerror=function(e){window.console.log("IndexedDB Error: "+o.message+" (Code "+o.code+")",o)};var s=r.objectStore(e);s.openCursor().onsuccess=function(e){var r=e.target.result;if(r){n.push(r.value);r.continue()}else{t(n)}}}catch(o){t([])}};var f=function(e,t,n){var r=i.transaction([e],"readwrite");var s=r.objectStore(e);s.delete(t).onsuccess=function(){n()}};var l=function(e,t){i.close();var r=n.open("storage_js",(new Date).getTime());r.onupgradeneeded=function(n){try{i=r.result;if(i.objectStoreNames.contains(e))i.deleteObjectStore(e);t()}catch(s){if(s.code!==3&&s.code!==8){window.console.log("IndexedDB Error: "+s.message+" (Code "+s.code+")",s)}else{t()}}}};var c=function(){i.close()};if(n){var h=n.open("storage_js");h.onupgradeneeded=function(e){window.console.log("UPGRADE NEEDED")};h.onsuccess=function(n){i=h.result;e({set:o,setAll:function(e,n,r){var i=t.sequencialActionCallbackWrapper(n,function(t){o(e,t,i.next)},r);i.next()},get:u,getAll:a,remove:f,removeAll:l,close:c})};h.onerror=function(t){window.console.log("An error ocurred",t);e()}}else{e()}}